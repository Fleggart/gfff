<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>手机软件收录</title>
  <script src="https://cdn.jsdelivr.net/npm/lunr/lunr.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; margin:0; background:#f9f9f9; }
    h1 { text-align:center; color:#333; }
    .filter { text-align:center; margin:10px 0; }
    .filter button { margin:0 5px; padding:5px 10px; cursor:pointer; }
    #searchInput { width: 100%; padding:8px; margin:10px 0; border-radius:4px; border:1px solid #ccc; }
    
    /* 两列布局 */
    .app-list {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      justify-items: center;
      margin-top: 10px;
    }

    .app {
      background:white;
      border-radius:8px;
      padding:15px;
      width: 90%;
      text-align:center;
      box-shadow:0 2px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    .app:hover { transform: translateY(-3px); }
    .app img { width:80px; height:80px; object-fit:cover; border-radius:10px; }
    .app a { text-decoration:none; color:#007bff; display:block; margin-top:5px; font-weight:bold; }
    .app p { font-size: 12px; color: #555; margin-top: 5px; line-height: 1.4; }

    .pagination { text-align:center; margin:20px 0; }
    .pagination button { margin:0 3px; padding:5px 8px; cursor:pointer; }
    @media(max-width:700px){
      .app-list { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <h1>手机软件收录</h1>

  <!-- 分类筛选 -->
  <div class="filter">
    <button onclick="filterApps('all')">全部</button>
    <button onclick="filterApps('game')">游戏</button>
    <button onclick="filterApps('tool')">工具</button>
    <button onclick="filterApps('media')">影音</button>
    <button onclick="filterApps('novel')">小说</button>
  </div>

  <!-- 搜索框 -->
  <input type="text" id="searchInput" placeholder="搜索软件" oninput="searchApps()">
  <div id="searchResults"></div>

  <!-- 软件列表 -->
  <div class="app-list" id="appList"></div>

  <!-- 分页按钮 -->
  <div class="pagination" id="pagination"></div>

  <script>
    let apps = [];
    let idx;
    let filteredApps = [];
    let currentPage = 1;
    const pageSize = 10; // 每页 5 行 × 2 列

    fetch('apps.json')
      .then(res => res.json())
      .then(data => {
        apps = data;
        filteredApps = apps;
        buildIndex();
        renderPage(currentPage);
      });

    function buildIndex(){
      idx = lunr(function () {
        this.ref('id');
        this.field('name');
        this.field('description');
        apps.forEach(app => this.add(app));
      });
    }

    function renderPage(page){
      const container = document.getElementById('appList');
      container.innerHTML = '';
      const start = (page -1) * pageSize;
      const end = start + pageSize;
      filteredApps.slice(start,end).forEach(app => {
        const div = document.createElement('div');
        div.className = 'app';
        div.setAttribute('data-category', app.category);
        div.innerHTML = `
          <img src="icon${app.id}.png" alt="${app.name}">
          <a href="${app.url}" target="_blank">${app.name}</a>
          <p>${app.description}</p>
        `;
        container.appendChild(div);
      });
      renderPagination();
    }

    function renderPagination(){
      const container = document.getElementById('pagination');
      container.innerHTML = '';
      const totalPages = Math.ceil(filteredApps.length / pageSize);

      if(totalPages <= 1) return;

      // 上一页
      const prev = document.createElement('button');
      prev.innerText = '上一页';
      prev.disabled = currentPage === 1;
      prev.onclick = ()=>{ currentPage--; renderPage(currentPage); };
      container.appendChild(prev);

      // 页码
      for(let i=1;i<=totalPages;i++){
        const btn = document.createElement('button');
        btn.innerText = i;
        if(i === currentPage) btn.style.fontWeight='bold';
        btn.onclick = ()=>{ currentPage=i; renderPage(currentPage); };
        container.appendChild(btn);
      }

      // 下一页
      const next = document.createElement('button');
      next.innerText = '下一页';
      next.disabled = currentPage === totalPages;
      next.onclick = ()=>{ currentPage++; renderPage(currentPage); };
      container.appendChild(next);
    }

    function filterApps(category){
      filteredApps = category === 'all' ? apps : apps.filter(a => a.category === category);
      currentPage = 1;
      document.getElementById('searchInput').value='';
      document.getElementById('searchResults').innerHTML='';
      renderPage(currentPage);
    }

    function searchApps(){
      const query = document.getElementById('searchInput').value;
      const resultsDiv = document.getElementById('searchResults');
      resultsDiv.innerHTML='';
      if(!query) {
        filteredApps = apps;
        currentPage=1;
        renderPage(currentPage);
        return;
      }
      const results = idx.search(query);
      filteredApps = results.map(r=>apps.find(a=>a.id===r.ref));
      currentPage = 1;
      renderPage(currentPage);
      resultsDiv.innerHTML = `<p>搜索到 ${filteredApps.length} 个结果</p>`;
    }
  </script>
</body>
</html>