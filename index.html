<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>手机软件收录</title>
  <script src="https://cdn.jsdelivr.net/npm/lunr/lunr.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; margin:0; background:#f9f9f9; }
    h1 { text-align:center; color:#333; }
    .filter { text-align:center; margin:10px 0; }
    .filter button { margin:0 5px; padding:5px 10px; cursor:pointer; }
    #searchInput { width: 100%; padding:8px; margin:10px 0; border-radius:4px; border:1px solid #ccc; }
    .app-list { display:flex; flex-wrap:wrap; gap:20px; justify-content:center; }
    .app { background:white; border-radius:8px; padding:10px; width:150px; text-align:center; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
    .app img { width:80px; height:80px; object-fit:cover; border-radius:10px; }
    .app a { text-decoration:none; color:#007bff; display:block; margin-top:5px; font-weight:bold; }
    #searchResults div { margin:5px 0; }
    #searchResults a { color:#007bff; text-decoration:none; font-weight:bold; }
    @media(max-width:500px){ .app { width:45%; } }
  </style>
</head>
<body>
  <h1>手机软件收录</h1>

  <!-- 分类筛选 -->
  <div class="filter">
    <button onclick="filterApps('all')">全部</button>
    <button onclick="filterApps('game')">游戏</button>
    <button onclick="filterApps('tool')">工具</button>
    <button onclick="filterApps('media')">影音</button>
  </div>

  <!-- 搜索框 -->
  <input type="text" id="searchInput" placeholder="搜索软件" oninput="searchApps()">
  <div id="searchResults"></div>

  <!-- 软件列表 -->
  <div class="app-list" id="appList"></div>

  <!-- 评论区 -->
  <h2 style="text-align:center; margin-top:40px;">评论区</h2>
  <div id="commento"></div>
  <script defer src="https://cdn.commento.io/js/commento.js"></script>

  <script>
    let apps = [];
    let idx;

    // 加载 JSON 数据
    fetch('apps.json')
      .then(res => res.json())
      .then(data => {
        apps = data;
        buildAppList(apps);

        // Lunr.js 索引
        idx = lunr(function () {
          this.ref('id');
          this.field('name');
          this.field('description');
          apps.forEach(app => this.add(app));
        });
      });

    // 构建软件列表
    function buildAppList(list){
      const container = document.getElementById('appList');
      container.innerHTML = '';
      list.forEach(app => {
        const div = document.createElement('div');
        div.className = 'app';
        div.setAttribute('data-category', app.category);
        div.innerHTML = `<img src="icon${app.id}.png" alt="${app.name}"><a href="${app.url}" target="_blank">${app.name}</a>`;
        container.appendChild(div);
      });
    }

    // 分类筛选
    function filterApps(category){
      const filtered = category === 'all' ? apps : apps.filter(a => a.category === category);
      buildAppList(filtered);
      document.getElementById('searchResults').innerHTML = ''; // 清空搜索结果
      document.getElementById('searchInput').value = '';
    }

    // 搜索功能
    function searchApps(){
      const query = document.getElementById('searchInput').value;
      const resultsDiv = document.getElementById('searchResults');
      resultsDiv.innerHTML = '';
      if(!query) return;
      const results = idx.search(query);
      results.forEach(result => {
        const app = apps.find(a => a.id === result.ref);
        const div = document.createElement('div');
        div.innerHTML = `<a href="${app.url}" target="_blank">${app.name}</a> - ${app.description}`;
        resultsDiv.appendChild(div);
      });
    }
  </script>
</body>
</html>